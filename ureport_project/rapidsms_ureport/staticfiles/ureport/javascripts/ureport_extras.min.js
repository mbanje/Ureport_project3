(function(a){a.PeriodicalUpdater=function(e,c){function d(){f(settings.url+(new Date).getTime(),settings.sendData,function(a){c&&c(a);PeriodicalTimer=setTimeout(d,settings.minTimeout)},settings.type)}settings=jQuery.extend({url:"",method:"get",sendData:"",minTimeout:15E3,maxTimeout:15E3,multiplier:1,type:"text"},e);f="post"==settings.method||"POST"==settings.method?a.post:a.get;settings.multiplier=1>settings.multiplier?1:settings.multiplier;d()}})(jQuery);
(function(a,e){var c;a.ureport=c={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not(button[type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",
requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input:file",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(d){var b=a('meta[name="csrf-token"]').attr("content");b&&d.setRequestHeader("X-CSRF-Token",b)},fire:function(d,b,c){b=a.Event(b);d.trigger(b,c);return!1!==b.result},confirm:function(a){return confirm(a)},ajax:function(d){return a.ajax(d)},href:function(a){return a.attr("href")},handleRemote:function(d){var b,
g,h,i,j;if(c.fire(d,"ajax:before")){i=d.data("cross-domain")||null;j=d.data("type")||a.ajaxSettings&&a.ajaxSettings.dataType;if(d.is("form")){b=d.attr("method");g=d.attr("action");h=d.serializeArray();var k=d.data("ujs:submit-button");k&&(h.push(k),d.data("ujs:submit-button",null))}else d.is(c.inputChangeSelector)?(b=d.data("method"),g=d.data("url"),h=d.serialize(),d.data("params")&&(h=h+"&"+d.data("params"))):(b=d.data("method"),g=c.href(d),h=d.data("params")||null);b={type:b||"GET",data:h,dataType:j,
crossDomain:i,beforeSend:function(a,b){b.dataType===e&&a.setRequestHeader("accept","*/*;q=0.5, "+b.accepts.script);return c.fire(d,"ajax:beforeSend",[a,b])},success:function(a,b,c){d.trigger("ajax:success",[a,b,c])},complete:function(a,b){d.trigger("ajax:complete",[a,b])},error:function(a,b,c){d.trigger("ajax:error",[a,b,c])}};g&&(b.url=g);return c.ajax(b)}return!1},handleMethod:function(d){var b=c.href(d),g=d.data("method"),d=d.attr("target"),h=a("meta[name=csrf-token]").attr("content"),i=a("meta[name=csrf-param]").attr("content"),
b=a('<form method="post" action="'+b+'"></form>'),g='<input name="_method" value="'+g+'" type="hidden" />';i!==e&&h!==e&&(g+='<input name="'+i+'" value="'+h+'" type="hidden" />');d&&b.attr("target",d);b.hide().append(g).appendTo("body");b.submit()},disableFormElements:function(d){d.find(c.disableSelector).each(function(){var b=a(this),d=b.is("button")?"html":"val";b.data("ujs:enable-with",b[d]());b[d](b.data("disable-with"));b.prop("disabled",!0)})},enableFormElements:function(d){d.find(c.enableSelector).each(function(){var b=
a(this),d=b.is("button")?"html":"val";if(b.data("ujs:enable-with"))b[d](b.data("ujs:enable-with"));b.prop("disabled",!1)})},allowAction:function(a){var b=a.data("confirm"),e=!1,h;if(!b)return!0;c.fire(a,"confirm")&&(e=c.confirm(b),h=c.fire(a,"confirm:complete",[e]));return e&&h},blankInputs:function(d,b,c){var e=a(),i;d.find(b||"input,textarea").each(function(){i=a(this);if(c?i.val():!i.val())e=e.add(i)});return e.length?e:!1},nonBlankInputs:function(a,b){return c.blankInputs(a,b,!0)},stopEverything:function(d){a(d.target).trigger("ujs:everythingStopped");
d.stopImmediatePropagation();return!1},callFormSubmitBindings:function(d,b){var c=d.data("events"),h=!0;c!==e&&c.submit!==e&&a.each(c.submit,function(a,d){if("function"===typeof d.handler)return h=d.handler(b)});return h},disableElement:function(a){a.data("ujs:enable-with",a.html());a.html(a.data("disable-with"));a.bind("click.ureportDisable",function(a){return c.stopEverything(a)})},enableElement:function(a){a.data("ujs:enable-with")!==e&&(a.html(a.data("ujs:enable-with")),a.data("ujs:enable-with",
!1));a.unbind("click.ureportDisable")}};a.ajaxPrefilter(function(a,b,e){a.crossDomain||c.CSRFProtection(e)});a(document).delegate(c.linkDisableSelector,"ajax:complete",function(){c.enableElement(a(this))});a(document).delegate(c.linkClickSelector,"click.ureport",function(d){var b=a(this),g=b.data("method"),h=b.data("params");if(!c.allowAction(b))return c.stopEverything(d);b.is(c.linkDisableSelector)&&c.disableElement(b);if(b.data("remote")!==e){if((d.metaKey||d.ctrlKey)&&(!g||"GET"===g)&&!h)return!0;
!1===c.handleRemote(b)&&c.enableElement(b);return!1}if(b.data("method"))return c.handleMethod(b),!1});a(document).delegate(c.inputChangeSelector,"change.ureport",function(d){var b=a(this);if(!c.allowAction(b))return c.stopEverything(d);c.handleRemote(b);return!1});a(document).delegate(c.formSubmitSelector,"submit.ureport",function(d){var b=a(this),g=b.data("remote")!==e,h=c.blankInputs(b,c.requiredInputSelector),i=c.nonBlankInputs(b,c.fileInputSelector);if(!c.allowAction(b)||h&&b.attr("novalidate")==
e&&c.fire(b,"ajax:aborted:required",[h]))return c.stopEverything(d);if(g){if(i)return c.fire(b,"ajax:aborted:file",[i]);if(!a.support.submitBubbles&&"1.7">a().jquery&&!1===c.callFormSubmitBindings(b,d))return c.stopEverything(d);c.handleRemote(b);return!1}setTimeout(function(){c.disableFormElements(b)},13)});a(document).delegate(c.formInputClickSelector,"click.ureport",function(d){var b=a(this);if(!c.allowAction(b))return c.stopEverything(d);d=(d=b.attr("name"))?{name:d,value:b.val()}:null;b.closest("form").data("ujs:submit-button",
d)});a(document).delegate(c.formSubmitSelector,"ajax:beforeSend.ureport",function(d){this==d.target&&c.disableFormElements(a(this))});a(document).delegate(c.formSubmitSelector,"ajax:complete.ureport",function(d){this==d.target&&c.enableFormElements(a(this))})})(jQuery);function BestInPlaceEditor(a){this.element=jQuery(a);this.initOptions();this.bindForm();this.initNil();$(this.activator).bind("click",{editor:this},this.clickHandler)}
BestInPlaceEditor.prototype={activate:function(){var a="",a=this.isNil?"":this.original_content?this.original_content:this.element.html();this.oldValue=this.isNil?"":this.element.html();this.display_value=a;$(this.activator).unbind("click",this.clickHandler);this.activateForm()},abort:function(){this.isNil?this.element.html(this.nil):this.element.html(this.oldValue);$(this.activator).bind("click",{editor:this},this.clickHandler);this.element.trigger($.Event("best_in_place:abort"))},abortIfConfirm:function(){confirm("Are you sure you want to discard your changes?")&&
this.abort()},update:function(){var a=this;if(this.formType in{input:1,textarea:1}&&this.getValue()==this.oldValue)return this.abort(),!0;this.isNil=!1;a.ajax({type:"post",dataType:"text",data:a.requestData(),success:function(c){a.loadSuccessCallback(c)},error:function(c,d){a.loadErrorCallback(c,d)}});if("select"==this.formType){var e=this.getValue();$.each(this.values,function(c,d){e==d[0]&&a.element.html(d[1])})}else"checkbox"==this.formType?a.element.html(this.getValue()?this.values[1]:this.values[0]):
a.element.html(""!=this.getValue()?this.getValue():this.nil);a.element.trigger($.Event("best_in_place:update"))},activateForm:function(){alert("The form was not properly initialized. activateForm is unbound")},initOptions:function(){var a=this;a.element.parents().each(function(){a.url=a.url||jQuery(this).attr("data-url");a.collection=a.collection||jQuery(this).attr("data-collection");a.formType=a.formType||jQuery(this).attr("data-type");a.objectName=a.objectName||jQuery(this).attr("data-object");
a.attributeName=a.attributeName||jQuery(this).attr("data-attribute");a.activator=a.activator||jQuery(this).attr("data-activator");a.okButton=a.okButton||jQuery(this).attr("data-ok-button");a.cancelButton=a.cancelButton||jQuery(this).attr("data-cancel-button");a.nil=a.nil||jQuery(this).attr("data-nil");a.inner_class=a.inner_class||jQuery(this).attr("data-inner-class");a.html_attrs=a.html_attrs||jQuery(this).attr("data-html-attrs");a.original_content=a.original_content||jQuery(this).attr("data-original-content")});
a.element.parents().each(function(){var e=this.id.match(/^(\w+)_(\d+)$/i);e&&(a.objectName=a.objectName||e[1])});a.url=a.element.attr("data-url")||a.url||document.location.pathname;a.collection=a.element.attr("data-collection")||a.collection;a.formType=a.element.attr("data-type")||a.formtype||"input";a.objectName=a.element.attr("data-object")||a.objectName;a.attributeName=a.element.attr("data-attribute")||a.attributeName;a.activator=a.element.attr("data-activator")||a.element;a.okButton=a.element.attr("data-ok-button")||
a.okButton;a.cancelButton=a.element.attr("data-cancel-button")||a.cancelButton;a.nil=a.element.attr("data-nil")||a.nil||"-";a.inner_class=a.element.attr("data-inner-class")||a.inner_class||null;a.html_attrs=a.element.attr("data-html-attrs")||a.html_attrs;a.original_content=a.element.attr("data-original-content")||a.original_content;a.sanitize=a.element.attr("data-sanitize")?"true"==a.element.attr("data-sanitize"):!0;if(("select"==a.formType||"checkbox"==a.formType)&&null!==a.collection)a.values=jQuery.parseJSON(a.collection)},
bindForm:function(){this.activateForm=BestInPlaceEditor.forms[this.formType].activateForm;this.getValue=BestInPlaceEditor.forms[this.formType].getValue},initNil:function(){""==this.element.html()&&(this.isNil=!0,this.element.html(this.nil))},getValue:function(){alert("The form was not properly initialized. getValue is unbound")},sanitizeValue:function(a){if(this.sanitize){var e=document.createElement("DIV");e.innerHTML=a;a=e.textContent||e.innerText}return jQuery.trim(a).replace(/"/g,"&quot;")},requestData:function(){csrf_token=
$("meta[name=csrf-token]").attr("content");csrf_param=$("meta[name=csrf-param]").attr("content");var a;a="_method=put"+("&"+this.objectName+"["+this.attributeName+"]="+encodeURIComponent(this.getValue()));void 0!==csrf_param&&void 0!==csrf_token&&(a+="&"+csrf_param+"="+encodeURIComponent(csrf_token));return a},ajax:function(a){a.url=this.url;a.beforeSend=function(a){a.setRequestHeader("Accept","application/json")};return jQuery.ajax(a)},loadSuccessCallback:function(a){var e=$.parseJSON($.trim(a));
null!=e&&e.hasOwnProperty("display_as")&&(this.element.attr("data-original-content",this.element.html()),this.original_content=this.element.html(),this.element.html(e.display_as));this.element.trigger($.Event("ajax:success"),a);$(this.activator).bind("click",{editor:this},this.clickHandler)},loadErrorCallback:function(a){this.element.html(this.oldValue);$.each(jQuery.parseJSON(a.responseText),function(a,c){"object"==typeof c&&(c=a+" "+c.toString());$("<span class='flash-error'></span>").html(c).purr()});
this.element.trigger($.Event("ajax:error"));$(this.activator).bind("click",{editor:this},this.clickHandler)},clickHandler:function(a){a.data.editor.activate()},setHtmlAttributes:function(){var a=this.element.find(this.formType),e=jQuery.parseJSON(this.html_attrs),c;for(c in e)a.attr(c,e[c])}};
BestInPlaceEditor.forms={input:{activateForm:function(){var a;a='<form class="form_in_place" action="javascript:void(0)" style="display:inline;">'+('<input type="text" name="'+this.attributeName+'" value="'+this.sanitizeValue(this.display_value)+'"');null!=this.inner_class&&(a+=' class="'+this.inner_class+'"');a+=">";this.okButton&&(a+='<input type="submit" value="'+this.okButton+'" />');this.cancelButton&&(a+='<input type="button" value="'+this.cancelButton+'" />');this.element.html(a+"</form>");
this.setHtmlAttributes();this.element.find("input[type='text']")[0].select();this.element.find("form").bind("submit",{editor:this},BestInPlaceEditor.forms.input.submitHandler);this.cancelButton&&this.element.find("input[type='button']").bind("click",{editor:this},BestInPlaceEditor.forms.input.cancelButtonHandler);this.element.find("input[type='text']").bind("blur",{editor:this},BestInPlaceEditor.forms.input.inputBlurHandler);this.element.find("input[type='text']").bind("keyup",{editor:this},BestInPlaceEditor.forms.input.keyupHandler);
this.blurTimer=null;this.userClicked=!1},getValue:function(){return this.sanitizeValue(this.element.find("input").val())},inputBlurHandler:function(a){a.data.editor.okButton?a.data.editor.blurTimer=setTimeout(function(){a.data.editor.userClicked||a.data.editor.abort()},500):a.data.editor.cancelButton?a.data.editor.blurTimer=setTimeout(function(){a.data.editor.userClicked||a.data.editor.update()},500):a.data.editor.update()},submitHandler:function(a){a.data.editor.userClicked=!0;clearTimeout(a.data.editor.blurTimer);
a.data.editor.update()},cancelButtonHandler:function(a){a.data.editor.userClicked=!0;clearTimeout(a.data.editor.blurTimer);a.data.editor.abort();a.stopPropagation()},keyupHandler:function(a){27==a.keyCode&&a.data.editor.abort()}},date:{activateForm:function(){var a=this,e;e='<form class="form_in_place" action="javascript:void(0)" style="display:inline;">'+('<input type="text" name="'+this.attributeName+'" value="'+this.sanitizeValue(this.display_value)+'"');null!=this.inner_class&&(e+=' class="'+
this.inner_class+'"');this.element.html(e+"></form>");this.setHtmlAttributes();this.element.find("input")[0].select();this.element.find("form").bind("submit",{editor:this},BestInPlaceEditor.forms.input.submitHandler);this.element.find("input").bind("keyup",{editor:this},BestInPlaceEditor.forms.input.keyupHandler);this.element.find("input").datepicker({onClose:function(){a.update()}}).datepicker("show")},getValue:function(){return this.sanitizeValue(this.element.find("input").val())},submitHandler:function(a){a.data.editor.update()},
keyupHandler:function(a){27==a.keyCode&&a.data.editor.abort()}},select:{activateForm:function(){var a="<form action='javascript:void(0)' style='display:inline;'><select>",e="",c=this.oldValue;$.each(this.values,function(d,b){e=b[1]==c?"selected='selected'":"";a+="<option value='"+b[0]+"' "+e+">"+b[1]+"</option>"});a+="</select></form>";this.element.html(a);this.setHtmlAttributes();this.element.find("select").bind("change",{editor:this},BestInPlaceEditor.forms.select.blurHandler);this.element.find("select").bind("blur",
{editor:this},BestInPlaceEditor.forms.select.blurHandler);this.element.find("select").bind("keyup",{editor:this},BestInPlaceEditor.forms.select.keyupHandler);this.element.find("select")[0].focus()},getValue:function(){return this.sanitizeValue(this.element.find("select").val())},blurHandler:function(a){a.data.editor.update()},keyupHandler:function(a){27==a.keyCode&&a.data.editor.abort()}},checkbox:{activateForm:function(){this.element.html(Boolean(this.oldValue!=this.values[1])?this.values[1]:this.values[0]);
this.setHtmlAttributes();this.update()},getValue:function(){return Boolean(this.element.html()==this.values[1])}},textarea:{activateForm:function(){width=this.element.css("width");height=this.element.css("height");var a;a='<form action="javascript:void(0)" style="display:inline;"><textarea>'+this.sanitizeValue(this.display_value);a+="</textarea>";this.okButton&&(a+='<input type="submit" value="'+this.okButton+'" />');this.cancelButton&&(a+='<input type="button" value="'+this.cancelButton+'" />');
this.element.html(a+"</form>");this.setHtmlAttributes();jQuery(this.element.find("textarea")[0]).css({"min-width":width,"min-height":height});jQuery(this.element.find("textarea")[0]).elastic();this.element.find("textarea")[0].focus();this.element.find("form").bind("submit",{editor:this},BestInPlaceEditor.forms.textarea.submitHandler);this.cancelButton&&this.element.find("input[type='button']").bind("click",{editor:this},BestInPlaceEditor.forms.textarea.cancelButtonHandler);this.element.find("textarea").bind("blur",
{editor:this},BestInPlaceEditor.forms.textarea.blurHandler);this.element.find("textarea").bind("keyup",{editor:this},BestInPlaceEditor.forms.textarea.keyupHandler);this.blurTimer=null;this.userClicked=!1},getValue:function(){return this.sanitizeValue(this.element.find("textarea").val())},blurHandler:function(a){a.data.editor.okButton?a.data.editor.blurTimer=setTimeout(function(){a.data.editor.userClicked||a.data.editor.abortIfConfirm()},500):a.data.editor.cancelButton?a.data.editor.blurTimer=setTimeout(function(){a.data.editor.userClicked||
a.data.editor.update()},500):a.data.editor.update()},submitHandler:function(a){a.data.editor.userClicked=!0;clearTimeout(a.data.editor.blurTimer);a.data.editor.update()},cancelButtonHandler:function(a){a.data.editor.userClicked=!0;clearTimeout(a.data.editor.blurTimer);a.data.editor.abortIfConfirm();a.stopPropagation()},keyupHandler:function(a){27==a.keyCode&&a.data.editor.abortIfConfirm()}}};
jQuery.fn.best_in_place=function(){this.each(function(){jQuery(this).data("bestInPlaceEditor")||jQuery(this).data("bestInPlaceEditor",new BestInPlaceEditor(this))});return this};
(function(a){a.fn.extend({elastic:function(){var e="paddingTop paddingRight paddingBottom paddingLeft fontSize lineHeight fontFamily width fontWeight".split(" ");return this.each(function(){function c(a,c){curratedHeight=Math.floor(parseInt(a,10));b.height()!=curratedHeight&&b.css({height:curratedHeight+"px",overflow:c})}function d(){var a=b.val().replace(/&/g,"&amp;").replace(/  /g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />"),d=g.html().replace(/<br>/ig,"<br />");a+"&nbsp;"!=d&&(g.html(a+
"&nbsp;"),3<Math.abs(g.height()+h-b.height())&&(a=g.height()+h,a>=j?c(j,"auto"):a<=i?c(i,"hidden"):c(a,"hidden")))}if("textarea"!=this.type)return!1;var b=a(this),g=a("<div />").css({position:"absolute",display:"none","word-wrap":"break-word"}),h=parseInt(b.css("line-height"),10)||parseInt(b.css("font-size"),"10"),i=parseInt(b.css("height"),10)||3*h,j=parseInt(b.css("max-height"),10)||Number.MAX_VALUE,k=0;0>j&&(j=Number.MAX_VALUE);g.appendTo(b.parent());for(k=e.length;k--;)g.css(e[k].toString(),b.css(e[k].toString()));
b.css({overflow:"hidden"});b.bind("keyup change cut paste",function(){d()});b.bind("blur",function(){g.height()<j&&(g.height()>i?b.height(g.height()):b.height(i))});b.live("input paste",function(){setTimeout(d,250)});d()})}})})(jQuery);
(function(a){a.purr=function(e,c){function d(){jQuery.browser.msie&&c.usingTransparentPNG?e.css({opacity:0}).animate({height:"0px"},{duration:c.fadeOutSpeed,complete:function(){e.remove()}}):e.animate({opacity:"0"},{duration:c.fadeOutSpeed,complete:function(){e.animate({height:"0px"},{duration:c.fadeOutSpeed,complete:function(){e.remove()}})}})}e=a(e);e.addClass("purr");var b=document.getElementById("purr-container");b||(b='<div id="purr-container"></div>');b=a(b);a("body").append(b);(function(){var g=
document.createElement("a");a(g).attr({className:"close",href:"#close"}).appendTo(e).click(function(){d();return!1});a(document).keyup(function(a){27==a.keyCode&&d()});e.appendTo(b).hide();jQuery.browser.msie&&c.usingTransparentPNG?e.show():e.fadeIn(c.fadeInSpeed);if(!c.isSticky)var h=setInterval(function(){0==e.prevAll(".purr").length&&(clearInterval(h),setTimeout(function(){d()},c.removeTimer))},200)})()};a.fn.purr=function(e){e=e||{};e.fadeInSpeed=e.fadeInSpeed||500;e.fadeOutSpeed=e.fadeOutSpeed||
500;e.removeTimer=e.removeTimer||4E3;e.isSticky=e.isSticky||!1;e.usingTransparentPNG=e.usingTransparentPNG||!1;this.each(function(){new a.purr(this,e)});return this}})(jQuery);